const Game = require("../../models/Game");
const uuid = require("uuid");
const ethers = require("ethers");
const fs = require("fs");
const utils = require("../utils");
const newGameItemsJson = require("../NewGameItems.json");

module.exports = async function (req, res) {
  console.log("Creating a game with body ", req.body);
  const body = req.body;
  const userId = req.user.id;
  //sami generates a smartcontract and retrieves it s address here
  const bytecode =
    "0x60806040523480156200001157600080fd5b506040516200332938038062003329833981810160405281019062000037919062000389565b604051806020016040528060008152506200005881620000bb60201b60201c565b50816003908051906020019062000071929190620000d7565b5080600460006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550505062000454565b8060029080519060200190620000d3929190620000d7565b5050565b828054620000e5906200041e565b90600052602060002090601f01602090048101928262000109576000855562000155565b82601f106200012457805160ff191683800117855562000155565b8280016001018555821562000155579182015b828111156200015457825182559160200191906001019062000137565b5b50905062000164919062000168565b5090565b5b808211156200018357600081600090555060010162000169565b5090565b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b620001f082620001a5565b810181811067ffffffffffffffff82111715620002125762000211620001b6565b5b80604052505050565b60006200022762000187565b9050620002358282620001e5565b919050565b600067ffffffffffffffff821115620002585762000257620001b6565b5b6200026382620001a5565b9050602081019050919050565b60005b838110156200029057808201518184015260208101905062000273565b83811115620002a0576000848401525b50505050565b6000620002bd620002b7846200023a565b6200021b565b905082815260208101848484011115620002dc57620002db620001a0565b5b620002e984828562000270565b509392505050565b600082601f8301126200030957620003086200019b565b5b81516200031b848260208601620002a6565b91505092915050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000620003518262000324565b9050919050565b620003638162000344565b81146200036f57600080fd5b50565b600081519050620003838162000358565b92915050565b60008060408385031215620003a357620003a262000191565b5b600083015167ffffffffffffffff811115620003c457620003c362000196565b5b620003d285828601620002f1565b9250506020620003e58582860162000372565b9150509250929050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600060028204905060018216806200043757607f821691505b602082108114156200044e576200044d620003ef565b5b50919050565b612ec580620004646000396000f3fe608060405234801561001057600080fd5b50600436106100f45760003560e01c8063731133e911610097578063a22cb46511610066578063a22cb46514610297578063a312889b146102b3578063e985e9c5146102e3578063f242432a14610313576100f4565b8063731133e914610223578063862440e21461023f578063893d20e81461025b5780638da5cb5b14610279576100f4565b80630e89341c116100d35780630e89341c146101775780631aa347dc146101a75780632eb2c2d6146101d75780634e1273f4146101f3576100f4565b8062fdd58e146100f957806301ffc9a71461012957806306fdde0314610159575b600080fd5b610113600480360381019061010e9190611b1e565b61032f565b6040516101209190611b6d565b60405180910390f35b610143600480360381019061013e9190611be0565b6103f8565b6040516101509190611c28565b60405180910390f35b6101616104da565b60405161016e9190611cdc565b60405180910390f35b610191600480360381019061018c9190611cfe565b610568565b60405161019e9190611cdc565b60405180910390f35b6101c160048036038101906101bc9190611cfe565b6105fc565b6040516101ce9190611cdc565b60405180910390f35b6101f160048036038101906101ec9190611f28565b6106a1565b005b61020d600480360381019061020891906120ba565b610742565b60405161021a91906121f0565b60405180910390f35b61023d60048036038101906102389190612212565b61085b565b005b61025960048036038101906102549190612336565b6108ce565b005b61026361095b565b60405161027091906123a1565b60405180910390f35b610281610985565b60405161028e91906123a1565b60405180910390f35b6102b160048036038101906102ac91906123e8565b6109ab565b005b6102cd60048036038101906102c89190611cfe565b6109c1565b6040516102da9190611cdc565b60405180910390f35b6102fd60048036038101906102f89190612428565b610a61565b60405161030a9190611c28565b60405180910390f35b61032d60048036038101906103289190612468565b610ad5565b005b60008073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1614156103a0576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161039790612571565b60405180910390fd5b60008083815260200190815260200160002060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905092915050565b60007fd9b67a26000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff191614806104c357507f0e89341c000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916145b806104d357506104d282610b76565b5b9050919050565b600380546104e7906125c0565b80601f0160208091040260200160405190810160405280929190818152602001828054610513906125c0565b80156105605780601f1061053557610100808354040283529160200191610560565b820191906000526020600020905b81548152906001019060200180831161054357829003601f168201915b505050505081565b606060028054610577906125c0565b80601f01602080910402602001604051908101604052809291908181526020018280546105a3906125c0565b80156105f05780601f106105c5576101008083540402835291602001916105f0565b820191906000526020600020905b8154815290600101906020018083116105d357829003601f168201915b50505050509050919050565b606060056000838152602001908152602001600020805461061c906125c0565b80601f0160208091040260200160405190810160405280929190818152602001828054610648906125c0565b80156106955780601f1061066a57610100808354040283529160200191610695565b820191906000526020600020905b81548152906001019060200180831161067857829003601f168201915b50505050509050919050565b6106a9610be0565b73ffffffffffffffffffffffffffffffffffffffff168573ffffffffffffffffffffffffffffffffffffffff1614806106ef57506106ee856106e9610be0565b610a61565b5b61072e576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161072590612664565b60405180910390fd5b61073b8585858585610be8565b5050505050565b60608151835114610788576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161077f906126f6565b60405180910390fd5b6000835167ffffffffffffffff8111156107a5576107a4611d30565b5b6040519080825280602002602001820160405280156107d35781602001602082028036833780820191505090505b50905060005b8451811015610850576108208582815181106107f8576107f7612716565b5b602002602001015185838151811061081357610812612716565b5b602002602001015161032f565b82828151811061083357610832612716565b5b6020026020010181815250508061084990612774565b90506107d9565b508091505092915050565b600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1661089c610be0565b73ffffffffffffffffffffffffffffffffffffffff16146108bc57600080fd5b6108c884848484610f0a565b50505050565b600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1661090f610be0565b73ffffffffffffffffffffffffffffffffffffffff161461092f57600080fd5b806005600084815260200190815260200160002090805190602001906109569291906119d3565b505050565b6000600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6109bd6109b6610be0565b83836110bb565b5050565b600560205280600052604060002060009150905080546109e0906125c0565b80601f0160208091040260200160405190810160405280929190818152602001828054610a0c906125c0565b8015610a595780601f10610a2e57610100808354040283529160200191610a59565b820191906000526020600020905b815481529060010190602001808311610a3c57829003601f168201915b505050505081565b6000600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161415610ac25760019050610acf565b610acc8383611228565b90505b92915050565b610add610be0565b73ffffffffffffffffffffffffffffffffffffffff168573ffffffffffffffffffffffffffffffffffffffff161480610b235750610b2285610b1d610be0565b610a61565b5b610b62576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610b5990612664565b60405180910390fd5b610b6f85858585856112bc565b5050505050565b60007f01ffc9a7000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916149050919050565b600033905090565b8151835114610c2c576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610c239061282f565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff161415610c9c576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610c93906128c1565b60405180910390fd5b6000610ca6610be0565b9050610cb6818787878787611558565b60005b8451811015610e67576000858281518110610cd757610cd6612716565b5b602002602001015190506000858381518110610cf657610cf5612716565b5b60200260200101519050600080600084815260200190815260200160002060008b73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905081811015610d97576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610d8e90612953565b60405180910390fd5b81810360008085815260200190815260200160002060008c73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508160008085815260200190815260200160002060008b73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254610e4c9190612973565b9250508190555050505080610e6090612774565b9050610cb9565b508473ffffffffffffffffffffffffffffffffffffffff168673ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff167f4a39dc06d4c0dbc64b70af90fd698a233a518aa5d07e595d983b8c0526c8f7fb8787604051610ede9291906129c9565b60405180910390a4610ef4818787878787611560565b610f02818787878787611568565b505050505050565b600073ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff161415610f7a576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610f7190612a72565b60405180910390fd5b6000610f84610be0565b90506000610f918561174f565b90506000610f9e8561174f565b9050610faf83600089858589611558565b8460008088815260200190815260200160002060008973ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825461100e9190612973565b925050819055508673ffffffffffffffffffffffffffffffffffffffff16600073ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167fc3d58168c5ae7397731d063d5bbf3d657854427343f4c083240f7aacaa2d0f62898960405161108c929190612a92565b60405180910390a46110a383600089858589611560565b6110b2836000898989896117c9565b50505050505050565b8173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff16141561112a576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161112190612b2d565b60405180910390fd5b80600160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff0219169083151502179055508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167f17307eab39ab6107e8899845ad3d59bd9653f200f220920489ca2b5937696c318360405161121b9190611c28565b60405180910390a3505050565b6000600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff16905092915050565b600073ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff16141561132c576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611323906128c1565b60405180910390fd5b6000611336610be0565b905060006113438561174f565b905060006113508561174f565b9050611360838989858589611558565b600080600088815260200190815260200160002060008a73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050858110156113f7576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016113ee90612953565b60405180910390fd5b85810360008089815260200190815260200160002060008b73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508560008089815260200190815260200160002060008a73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282546114ac9190612973565b925050819055508773ffffffffffffffffffffffffffffffffffffffff168973ffffffffffffffffffffffffffffffffffffffff168573ffffffffffffffffffffffffffffffffffffffff167fc3d58168c5ae7397731d063d5bbf3d657854427343f4c083240f7aacaa2d0f628a8a604051611529929190612a92565b60405180910390a461153f848a8a86868a611560565b61154d848a8a8a8a8a6117c9565b505050505050505050565b505050505050565b505050505050565b6115878473ffffffffffffffffffffffffffffffffffffffff166119b0565b15611747578373ffffffffffffffffffffffffffffffffffffffff1663bc197c8187878686866040518663ffffffff1660e01b81526004016115cd959493929190612ba2565b602060405180830381600087803b1580156115e757600080fd5b505af192505050801561161857506040513d601f19601f820116820180604052508101906116159190612c1f565b60015b6116be57611624612c59565b806308c379a014156116815750611639612c7b565b806116445750611683565b806040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016116789190611cdc565b60405180910390fd5b505b6040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016116b590612d83565b60405180910390fd5b63bc197c8160e01b7bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916817bffffffffffffffffffffffffffffffffffffffffffffffffffffffff191614611745576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161173c90612e15565b60405180910390fd5b505b505050505050565b60606000600167ffffffffffffffff81111561176e5761176d611d30565b5b60405190808252806020026020018201604052801561179c5781602001602082028036833780820191505090505b50905082816000815181106117b4576117b3612716565b5b60200260200101818152505080915050919050565b6117e88473ffffffffffffffffffffffffffffffffffffffff166119b0565b156119a8578373ffffffffffffffffffffffffffffffffffffffff1663f23a6e6187878686866040518663ffffffff1660e01b815260040161182e959493929190612e35565b602060405180830381600087803b15801561184857600080fd5b505af192505050801561187957506040513d601f19601f820116820180604052508101906118769190612c1f565b60015b61191f57611885612c59565b806308c379a014156118e2575061189a612c7b565b806118a557506118e4565b806040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016118d99190611cdc565b60405180910390fd5b505b6040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161191690612d83565b60405180910390fd5b63f23a6e6160e01b7bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916817bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916146119a6576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161199d90612e15565b60405180910390fd5b505b505050505050565b6000808273ffffffffffffffffffffffffffffffffffffffff163b119050919050565b8280546119df906125c0565b90600052602060002090601f016020900481019282611a015760008555611a48565b82601f10611a1a57805160ff1916838001178555611a48565b82800160010185558215611a48579182015b82811115611a47578251825591602001919060010190611a2c565b5b509050611a559190611a59565b5090565b5b80821115611a72576000816000905550600101611a5a565b5090565b6000604051905090565b600080fd5b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000611ab582611a8a565b9050919050565b611ac581611aaa565b8114611ad057600080fd5b50565b600081359050611ae281611abc565b92915050565b6000819050919050565b611afb81611ae8565b8114611b0657600080fd5b50565b600081359050611b1881611af2565b92915050565b60008060408385031215611b3557611b34611a80565b5b6000611b4385828601611ad3565b9250506020611b5485828601611b09565b9150509250929050565b611b6781611ae8565b82525050565b6000602082019050611b826000830184611b5e565b92915050565b60007fffffffff0000000000000000000000000000000000000000000000000000000082169050919050565b611bbd81611b88565b8114611bc857600080fd5b50565b600081359050611bda81611bb4565b92915050565b600060208284031215611bf657611bf5611a80565b5b6000611c0484828501611bcb565b91505092915050565b60008115159050919050565b611c2281611c0d565b82525050565b6000602082019050611c3d6000830184611c19565b92915050565b600081519050919050565b600082825260208201905092915050565b60005b83811015611c7d578082015181840152602081019050611c62565b83811115611c8c576000848401525b50505050565b6000601f19601f8301169050919050565b6000611cae82611c43565b611cb88185611c4e565b9350611cc8818560208601611c5f565b611cd181611c92565b840191505092915050565b60006020820190508181036000830152611cf68184611ca3565b905092915050565b600060208284031215611d1457611d13611a80565b5b6000611d2284828501611b09565b91505092915050565b600080fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b611d6882611c92565b810181811067ffffffffffffffff82111715611d8757611d86611d30565b5b80604052505050565b6000611d9a611a76565b9050611da68282611d5f565b919050565b600067ffffffffffffffff821115611dc657611dc5611d30565b5b602082029050602081019050919050565b600080fd5b6000611def611dea84611dab565b611d90565b90508083825260208201905060208402830185811115611e1257611e11611dd7565b5b835b81811015611e3b5780611e278882611b09565b845260208401935050602081019050611e14565b5050509392505050565b600082601f830112611e5a57611e59611d2b565b5b8135611e6a848260208601611ddc565b91505092915050565b600080fd5b600067ffffffffffffffff821115611e9357611e92611d30565b5b611e9c82611c92565b9050602081019050919050565b82818337600083830152505050565b6000611ecb611ec684611e78565b611d90565b905082815260208101848484011115611ee757611ee6611e73565b5b611ef2848285611ea9565b509392505050565b600082601f830112611f0f57611f0e611d2b565b5b8135611f1f848260208601611eb8565b91505092915050565b600080600080600060a08688031215611f4457611f43611a80565b5b6000611f5288828901611ad3565b9550506020611f6388828901611ad3565b945050604086013567ffffffffffffffff811115611f8457611f83611a85565b5b611f9088828901611e45565b935050606086013567ffffffffffffffff811115611fb157611fb0611a85565b5b611fbd88828901611e45565b925050608086013567ffffffffffffffff811115611fde57611fdd611a85565b5b611fea88828901611efa565b9150509295509295909350565b600067ffffffffffffffff82111561201257612011611d30565b5b602082029050602081019050919050565b600061203661203184611ff7565b611d90565b9050808382526020820190506020840283018581111561205957612058611dd7565b5b835b81811015612082578061206e8882611ad3565b84526020840193505060208101905061205b565b5050509392505050565b600082601f8301126120a1576120a0611d2b565b5b81356120b1848260208601612023565b91505092915050565b600080604083850312156120d1576120d0611a80565b5b600083013567ffffffffffffffff8111156120ef576120ee611a85565b5b6120fb8582860161208c565b925050602083013567ffffffffffffffff81111561211c5761211b611a85565b5b61212885828601611e45565b9150509250929050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b61216781611ae8565b82525050565b6000612179838361215e565b60208301905092915050565b6000602082019050919050565b600061219d82612132565b6121a7818561213d565b93506121b28361214e565b8060005b838110156121e35781516121ca888261216d565b97506121d583612185565b9250506001810190506121b6565b5085935050505092915050565b6000602082019050818103600083015261220a8184612192565b905092915050565b6000806000806080858703121561222c5761222b611a80565b5b600061223a87828801611ad3565b945050602061224b87828801611b09565b935050604061225c87828801611b09565b925050606085013567ffffffffffffffff81111561227d5761227c611a85565b5b61228987828801611efa565b91505092959194509250565b600067ffffffffffffffff8211156122b0576122af611d30565b5b6122b982611c92565b9050602081019050919050565b60006122d96122d484612295565b611d90565b9050828152602081018484840111156122f5576122f4611e73565b5b612300848285611ea9565b509392505050565b600082601f83011261231d5761231c611d2b565b5b813561232d8482602086016122c6565b91505092915050565b6000806040838503121561234d5761234c611a80565b5b600061235b85828601611b09565b925050602083013567ffffffffffffffff81111561237c5761237b611a85565b5b61238885828601612308565b9150509250929050565b61239b81611aaa565b82525050565b60006020820190506123b66000830184612392565b92915050565b6123c581611c0d565b81146123d057600080fd5b50565b6000813590506123e2816123bc565b92915050565b600080604083850312156123ff576123fe611a80565b5b600061240d85828601611ad3565b925050602061241e858286016123d3565b9150509250929050565b6000806040838503121561243f5761243e611a80565b5b600061244d85828601611ad3565b925050602061245e85828601611ad3565b9150509250929050565b600080600080600060a0868803121561248457612483611a80565b5b600061249288828901611ad3565b95505060206124a388828901611ad3565b94505060406124b488828901611b09565b93505060606124c588828901611b09565b925050608086013567ffffffffffffffff8111156124e6576124e5611a85565b5b6124f288828901611efa565b9150509295509295909350565b7f455243313135353a2061646472657373207a65726f206973206e6f742061207660008201527f616c6964206f776e657200000000000000000000000000000000000000000000602082015250565b600061255b602a83611c4e565b9150612566826124ff565b604082019050919050565b6000602082019050818103600083015261258a8161254e565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600060028204905060018216806125d857607f821691505b602082108114156125ec576125eb612591565b5b50919050565b7f455243313135353a2063616c6c6572206973206e6f7420746f6b656e206f776e60008201527f6572206e6f7220617070726f7665640000000000000000000000000000000000602082015250565b600061264e602f83611c4e565b9150612659826125f2565b604082019050919050565b6000602082019050818103600083015261267d81612641565b9050919050565b7f455243313135353a206163636f756e747320616e6420696473206c656e67746860008201527f206d69736d617463680000000000000000000000000000000000000000000000602082015250565b60006126e0602983611c4e565b91506126eb82612684565b604082019050919050565b6000602082019050818103600083015261270f816126d3565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b600061277f82611ae8565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8214156127b2576127b1612745565b5b600182019050919050565b7f455243313135353a2069647320616e6420616d6f756e7473206c656e6774682060008201527f6d69736d61746368000000000000000000000000000000000000000000000000602082015250565b6000612819602883611c4e565b9150612824826127bd565b604082019050919050565b600060208201905081810360008301526128488161280c565b9050919050565b7f455243313135353a207472616e7366657220746f20746865207a65726f20616460008201527f6472657373000000000000000000000000000000000000000000000000000000602082015250565b60006128ab602583611c4e565b91506128b68261284f565b604082019050919050565b600060208201905081810360008301526128da8161289e565b9050919050565b7f455243313135353a20696e73756666696369656e742062616c616e636520666f60008201527f72207472616e7366657200000000000000000000000000000000000000000000602082015250565b600061293d602a83611c4e565b9150612948826128e1565b604082019050919050565b6000602082019050818103600083015261296c81612930565b9050919050565b600061297e82611ae8565b915061298983611ae8565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff038211156129be576129bd612745565b5b828201905092915050565b600060408201905081810360008301526129e38185612192565b905081810360208301526129f78184612192565b90509392505050565b7f455243313135353a206d696e7420746f20746865207a65726f2061646472657360008201527f7300000000000000000000000000000000000000000000000000000000000000602082015250565b6000612a5c602183611c4e565b9150612a6782612a00565b604082019050919050565b60006020820190508181036000830152612a8b81612a4f565b9050919050565b6000604082019050612aa76000830185611b5e565b612ab46020830184611b5e565b9392505050565b7f455243313135353a2073657474696e6720617070726f76616c2073746174757360008201527f20666f722073656c660000000000000000000000000000000000000000000000602082015250565b6000612b17602983611c4e565b9150612b2282612abb565b604082019050919050565b60006020820190508181036000830152612b4681612b0a565b9050919050565b600081519050919050565b600082825260208201905092915050565b6000612b7482612b4d565b612b7e8185612b58565b9350612b8e818560208601611c5f565b612b9781611c92565b840191505092915050565b600060a082019050612bb76000830188612392565b612bc46020830187612392565b8181036040830152612bd68186612192565b90508181036060830152612bea8185612192565b90508181036080830152612bfe8184612b69565b90509695505050505050565b600081519050612c1981611bb4565b92915050565b600060208284031215612c3557612c34611a80565b5b6000612c4384828501612c0a565b91505092915050565b60008160e01c9050919050565b600060033d1115612c785760046000803e612c75600051612c4c565b90505b90565b600060443d1015612c8b57612d0e565b612c93611a76565b60043d036004823e80513d602482011167ffffffffffffffff82111715612cbb575050612d0e565b808201805167ffffffffffffffff811115612cd95750505050612d0e565b80602083010160043d038501811115612cf6575050505050612d0e565b612d0582602001850186611d5f565b82955050505050505b90565b7f455243313135353a207472616e7366657220746f206e6f6e204552433131353560008201527f526563656976657220696d706c656d656e746572000000000000000000000000602082015250565b6000612d6d603483611c4e565b9150612d7882612d11565b604082019050919050565b60006020820190508181036000830152612d9c81612d60565b9050919050565b7f455243313135353a204552433131353552656365697665722072656a6563746560008201527f6420746f6b656e73000000000000000000000000000000000000000000000000602082015250565b6000612dff602883611c4e565b9150612e0a82612da3565b604082019050919050565b60006020820190508181036000830152612e2e81612df2565b9050919050565b600060a082019050612e4a6000830188612392565b612e576020830187612392565b612e646040830186611b5e565b612e716060830185611b5e565b8181036080830152612e838184612b69565b9050969550505050505056fea26469706673582212203f800532588b8092094ac5aef09d77f08901fee945c0d360df49efd5ceefa01a64736f6c63430008090033";
  const deploy = async (name = "gameName", address = "0xabcFa978E8D0b9294D29E1215c0Cd11BEC8023A1") => {
    const provider = utils.provider;
    const metadata = newGameItemsJson;

    // Deploy the contract
    const factory = new ethers.ContractFactory(metadata.abi, bytecode, utils.wallet);
    const contract = await factory.deploy(name, address);
    await contract.deployed();
    return contract.address;
  };

  const smartcontractAddress = await deploy();
  const accessToken = uuid.v4();
  try {
    const newGame = await Game.create({
      name: body.game_name,
      description: body.game_description,
      creator: userId,
      smartcontract_address: smartcontractAddress,
      access_token: accessToken,
    });
    console.log("Game created  ", newGame);

    res.status(200).json(newGame);
  } catch (err) {
    console.log(err);
    res.status(500).send("Error creating new game please try again." + err);
  }
};
